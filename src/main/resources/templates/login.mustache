<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link rel="stylesheet" href="/login.css" />
    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js"charset="utf-8"></script>
    <meta name ="google-signin-client_id" content="561777368048-ns5u9td7q0e2nvaq193ndjvr61uisi5r.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/api:client.js"></script>
</head>
<body>
<a class="main-logo" href="/">
    <div class="text-light heading d-flex align-items-center justify-content-flex-start mt-3">
        <i class="fa-regular fa-mango mx-3 p-1"></i> Mango Music
    </div>
</a>
<div class="login-box">
    <form method="post" action="/login" id="login-form">
        <h2>Login</h2>
        <div class="user-box">
            <input type="text" name="user-id" placeholder="ID">
            <!--                    <label>ID</label>-->
        </div>
        <div class="user-box">
            <input type="password" name="user-pw" placeholder="Password">
            <!--                    <label>PW</label>-->
        </div>
        <div id="findIdPw">
            <a class="find" href="/findId">아이디 찾기</a>
            <span class="find">/</span>
            <a class="find" href="/findPw">비밀번호 찾기</a>
        </div>
        <div id="login-btn">
            <button type="submit" id="login-b" class="login-btn">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                로그인
            </button>
            <button type="button" class="login-btn" onclick="location.href='/register'">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                회원가입
            </button>
        </div>
        <div class="snsLogin">
<!--            <a class="sns" href="#"><img class="login-logo" src="Login_img/btn_google_signin_light_focus_web@2x.png" alt="구글 로그인"></a> <br>-->
            <ul>
                <li id="GgCustomLogin">
                    <a href="javascript:void(0)">
                        Login with Google
                    </a>
                </li>
            </ul>
            <a class="sns" href="#"><img class="login-logo" src="Login_img/btnG_완성형.png" alt="네이버 로그인"></a> <br>
            <a class="sns" href="#"><img class="login-logo" src="Login_img/kakao_login_large_wide.png" alt="카카오 로그인"></a> <br>
        </div>
    </form>
</div>
<script>
    {{#error}}
        window.onload = function() {
            alert("아이디 또는 비밀번호를 확인해주세요.")
        }
    {{/error}}
    {{#success}}
        window.onload = function() {
            alert("축하합니다. 회원가입에 성공하셨습니다.")
        }
    {{/success}}
    {{#findId}}
        window.onload = function () {
            window.open('/newFind?userName={{user.userName}}&userEmail={{user.userEmail}}','','bottom=600, left=800, width=500, height=300');
        }
    {{/findId}}
    {{#findPw}}
        window.onload = function () {
            window.open('/updatePw?userId={{user.userId}}&userName={{user.userName}}&userEmail={{user.userEmail}}','','bottom=600, left=800, width=500, height=300');
        }
    {{/findPw}}
    {{#su}}
        window.close();
    {{/su}}

    //처음 실행하는 함수
    function init() {
        gapi.load('auth2', function() {
            gapi.auth2.init();
            options = new gapi.auth2.SigninOptionsBuilder();
            options.setPrompt('select_account');
            // 추가는 Oauth 승인 권한 추가 후 띄어쓰기 기준으로 추가
            options.setScope('email profile openid https://www.googleapis.com/auth/user.birthday.read');
            // 인스턴스의 함수 호출 - element에 로그인 기능 추가
            // GgCustomLogin은 li태그안에 있는 ID, 위에 설정한 options와 아래 성공,실패시 실행하는 함수들
            gapi.auth2.getAuthInstance().attachClickHandler('GgCustomLogin', options, onSignIn, onSignInFailure);
        })
    }
    // 구글 로그인 api
    function onSignIn(googleUser) {
        var access_token = googleUser.getAuthResponse().access_token
        $.ajax({
            // people api를 이용하여 프로필 및 생년월일에 대한 선택동의후 가져온다.
            url: 'https://people.googleapis.com/v1/people/me'
            // key에 자신의 API 키를 넣습니다.
            , data: {personFields:'birthdays', key:'AIzaSyBScc-YZc-YZ4IF1ZMUuD0hH6bBwM047fM', 'access_token': access_token}
            , method:'GET'
        })
                .done(function(e){
                    //프로필을 가져온다.
                    var profile = googleUser.getBasicProfile();
                    console.log(profile)
                })
                .fail(function(e){
                    console.log(e);
                })
    }
    function onSignInFailure(t){
        console.log(t);
    }
</script>
<!--구글 api 사용을 위한 스크립트-->
<script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
</body>
</html>